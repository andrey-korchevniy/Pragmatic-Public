<!DOCTYPE html>
<html lang="en"><head>
  
<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=UA-121072033-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
    dataLayer.push(arguments);
  }

  gtag('js', new Date());

  gtag('config', 'UA-121072033-1');
</script>



  <meta charset="UTF-8" />
<meta
  name="description"
  content="Pragmatic DLT Makes Exclusive Clutch Leaders List for Canada Developers! || Pragmatic DLT" />
<meta name="author" content="Max Martyn | Pragmatic DLT" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="keywords"
  content="ethereum developers, smart contracts developers, blockchain developers, Canada" />
<title>Insights</title>
<link rel="icon" href="../../images/favicon.png" />

  <link rel="stylesheet" href="../../css/article.css" />
<link
  href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,500i,600|Roboto:100,300,400,500"
  rel="stylesheet" />

<script>
  !(function (f, b, e, v, n, t, s) {
    if (f.fbq) return;
    n = f.fbq = function () {
      n.callMethod ? n.callMethod.apply(n, arguments) : n.queue.push(arguments);
    };
    if (!f._fbq) f._fbq = n;
    n.push = n;
    n.loaded = !0;
    n.version = '2.0';
    n.queue = [];
    t = b.createElement(e);
    t.async = !0;
    t.src = v;
    s = b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t, s);
  })(
    window,
    document,
    'script',
    'https://connect.facebook.net/en_US/fbevents.js'
  );
  fbq('init', '1759345877474918');
  fbq('track', 'PageView');
</script>
<noscript>
  <img
    height="1"
    width="1"
    src="https://www.facebook.com/tr?id=1759345877474918&ev=PageView&noscript=1" />
</noscript>



  
<script>
  (function (h, o, t, j, a, r) {
    h.hj =
      h.hj ||
      function () {
        (h.hj.q = h.hj.q || []).push(arguments);
      };
    h._hjSettings = { hjid: 1001459, hjsv: 6 };
    a = o.getElementsByTagName('head')[0];
    r = o.createElement('script');
    r.async = 1;
    r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
    a.appendChild(r);
  })(window, document, 'https://static.hotjar.com/c/hotjar-', '.js?sv=');
</script>



  
  
  

  
<script
  type="text/javascript"
  src="https://static1.clutch.co/api/widget.js"></script>


</head>
<body>
    
<div id="fb-root"></div>
<script>
  window.fbAsyncInit = function () {
    FB.init({
      xfbml: true,
      version: 'v3.2',
    });
  };

  (function (d, s, id) {
    var js,
      fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s);
    js.id = id;
    js.src = 'https://connect.facebook.net/en_US/sdk/xfbml.customerchat.js';
    fjs.parentNode.insertBefore(js, fjs);
  })(document, 'script', 'facebook-jssdk');
</script>


<div
  class="fb-customerchat"
  attribution="setup_tool"
  page_id="2084946921832496"
  logged_in_greeting="Hi! Let us know if you want to get an estimate for your project."
  logged_out_greeting="Hi! Let us know if you want to get an estimate for your project."></div>
<header>
  <nav class="content">
    <a href="index.html" class="logo">
      <img
        src="../../images/logo.svg"
        alt="Pragmatic DLT. Blockchain Development and Consulting" />
      <h1 class="logo-text">pragmatic<br /><span>dlt</span></h1>
    </a>

    <div class="menu">
      
      <a href="../../index.html#service-offering">Services</a>
      <a href="../../insights" class="active">Insights</a>
      <a href="../../index.html#team">About</a>
      <button class="contact-us">Free Quote</button>
    </div>

    <div class="mobile-menu">
      <button class="menu-button">
        <img src="../../images/menu.svg" alt="Menu" />
      </button>

      <div>
        
        <a href="index.html#service-offering">Services</a>
        <a href="insights.html" class="active">Insights</a>
        <a href="index.html#team">About</a>
        <hr />
        <button class="contact-us">Free Quote</button>
      </div>
    </div>
  </nav>
</header>

    <main>
      <div
        class="bg"
        style="
          background-image: url('/insights/setup_ethereum/ethimage.png');
        "></div>

      <section class="insight"><h1 id="setup-private-ethereum-network-in-cloud">Setup private Ethereum network in cloud</h1>
<p>This insight is a step by step guide how to launch private Ethereum network. It is a great starting point to start experiments and play with different setup and configuration options for your specific needs (block creation time, number of nodes per availability zone, block target gas limit, etc&hellip;).</p>
<h3 id="private-chain">Private chain</h3>
<p>A private chain can potentially have huge advantages over public - level of control we get is much higher. Designing architecture for specific business needs, with private network setup we have more flexibility around transaction cost, latency and other quality attributes.</p>
<h3 id="key-points-about-ethereum-clique">Key points about Ethereum Clique</h3>
<p>Ethereum Clique is Proof-of-Authority consensus algorithm implementation deployed to Rinkeby test network. PoA is a near perfect fit for private networks as it gives us full control over which nodes can seal (validate/create) blocks on the network. There are number of pre-approved seal nodes (validators) defined in genesis file. Addition of the new seal node requires voting by existing seal nodes.</p>
<p>There are three essential rules to note before we start:</p>
<p><span class="formula"> K</span>
 - number of seal nodes on chain,<br>
<span class="formula"> N</span>
 - number of produced blocks</p>
<ol>
<li>Chain will produce new blocks until <span class="formula"> floor(K2+1) </span>
of seal nodes are online</li>
<li>Node picked up to validate next block is defined as <span class="formula"> N mod K</span>
.</li>
<li>Node can be picked up as validator if last <span class="formula">  floor(K + 12) </span>
 blocks was not validated by it</li>
</ol>
<h3 id="test-scenario">Test scenario</h3>
<p>A few words about how our test transaction looks like. In a nutshell it represents the following scenario:</p>
<p><span class="bold">Given​</span>
​ user logged in as brand<br>
<span class="bold">And​</span>
​ balance is 100 tokens<br>
<span class="bold">When​</span>
​ user types unit name<br>
<span class="bold">And​</span>
​ clicks create<br>
<span class="bold">Then​</span>
​ unit appears in unit list<br>
<span class="bold">And​</span>
​ balance is 99 tokens</p>
<p>Scenario is implemented in the smart contract in the following way:
<img src="code.png" alt="code">
Under the hood the following business logic comes into play:</p>
<ol>
<li>Check that sender has brand role (modifier)</li>
<li>Charge unitPrice as a fee from sender (erc20)</li>
<li>Create unit and save to array (update contract state)</li>
<li>Communicate what happened off-chain (emit event)</li>
</ol>
<h3 id="setup-manual">Setup manual</h3>
<h5 id="0-prerequisites">0. Prerequisites</h5>
<p>As cloud platform we use Microsoft Azure. BTW, It kindly offers 200$ as trial option. We created 8 VMs in two regions. 4 VMs withing one availability zone of Central US region and three others within France Central. Each VM(<a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes-general">DS1_v2</a>) has 1 vCPU, 7GB SDD, 3.5GB of RAM and Ubuntu 16 on board. Plus, a separate VM to deploy the Ethereum statistics. There is a list of machines needed for experiment with some useful info in the name (it&rsquo;s a good idea to note IP address next to VM name):</p>
<ol>
<li>boot-node-us</li>
<li>seal-1-node-us</li>
<li>seal-2-node-us</li>
<li>seal-3-node-us</li>
<li>boot-node-eu</li>
<li>seal-1-node-eu</li>
<li>seal-2-node-eu</li>
<li>seal-3-node-eu</li>
<li>stats-node</li>
</ol>
<h5 id="1-install-go-to-each-node">1. Install go (to each node):</h5>
<p class="bash-command">
$ curl https://dl.google.com/go/go1.11.linux-amd64.tar.gz > go1.11.linux-amd64.tar.gz
$ sudo tar -C /usr/local -xzf go1.11.linux-amd64.tar.gz
$ mkdir ~/.go
</p>

<p>add to /etc/profile:</p>
<p class="bash-command">
GOROOT=/usr/local/g </br>  
GOPATH=~/.go </br>
PATH=$PATH:$GOROOT/bin:$GOPATH/bin
</p>

<p class="bash-command">
$ sudo update-alternatives --install "/usr/bin/go" "go" "/usr/local/go/bin/go" 0 </br>
$ sudo update-alternatives --set go /usr/local/go/bin/go </br>
$ go version
</p>

<h5 id="2-download-and-build-go-ethereum-on-each-node">2. Download and build go-ethereum (on each node):</h5>
<p class="bash-command">
$ sudo apt-get update </br>
$ sudo apt-get install -y build-essential </br>
$ git clone https://github.com/ethereum/go-ethereum </br>
$ cd go-ethereum </br>
$ git checkout tags/v1.8.16` (`git tag -l`) </br>
$ make all </br>
</p>

<h5 id="3-setup-ethstats">3. Setup ethstats</h5>
<p>In order to do this the best option is to use puppeth. First, install docker to stats-node:
<p class="bash-command">
$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</br>
$ sudo apt-get install docker-compose</br>
$ sudo usermod -aG docker $USER</br>
$ relogin</br>
</p>
</p>
<p>Then, run puppeth and follow CLI instructions to deploy ethstats:
<p class="bash-command">
$ ~/go-ethereum/build/bin/puppeth
</p>
</p>
<h5 id="4-setup-seal-node-n-repeat-to-all-seal-nodes">4. Setup seal-node-n (repeat to all seal nodes)</h5>
<p class="bash-command">
$ mkdir -p ~/supplychain/seal-node-n
</p>

<p>Create a bunch of tests accounts - create at least 2-3 accounts.
<p class="bash-command">
$ cd ~/supplychain</br>
$ ~/go-ethereum/build/bin/geth --datadir seal-node-n/ account new
</p>
</p>
<h5 id="5-create-genesisjson-using-puppeth-run-puppeth-on-stats-node-and-follow-cli-instruction-to-generate-genesis-file">5. Create <code>genesis.json</code> using puppeth (run puppeth on stats-node and follow CLI instruction to generate genesis file)</h5>
<p class="bash-command">
$ ~/go-ethereum/build/bin/puppeth
</p>

<p>Use puppeth CLI to export just created genesis file to home directory.</p>
<h5 id="6-init-seal-node-n">6. Init seal-node-n</h5>
<p class="bash-command">
$ cd ~/supplychain</br>
$ scp -r _user_@_stats-node-ip_:~/supplychain.json .</br>
$ ~/go-ethereum/build/bin/geth --datadir seal-node-n/ init supplychain.json</br>
</p>

<h5 id="7-run-boot-node">7. Run boot-node:</h5>
<p class="bash-command">
$ mkdir -p ~/supplychain/bootnode</br>
$ cd ~/supplychain</br>
$ scp -r _user_@_stats-node-ip_:~/supplychain.json .</br>
$ ~/go-ethereum/build/bin/geth --datadir bootnode init supplychain.json</br>
$ ~/go-ethereum/builds/bin/bootnode -genkey boot.key</br>
$ ~/go-ethereum/build/bin/bootnode -nodekey boot.key -verbosity 9 -addr :30310</br>
</p>

<h5 id="8-run-seal-node-n">8. Run seal-node-n:</h5>
<p>write pass to <code>seal-node-n.pass</code>
<p class="bash-command">
$ ~/go-ethereum/build/bin/geth --datadir seal-node-n/ --syncmode 'full' --port 30311 --rpc --rpcaddr '0.0.0.0'</br>
--rpcport 8501 --rpcapi 'personal,db,eth,net,web3,txpool,miner' --bootnodes</br>
'_bootnode_enode_@_bootnode_ip_:30310'</br>
--networkid 1605 --gasprice '1' -unlock '_seal_node_n_account_' --password ./seal-node-n.pass</br>
--mine --ethstats seal-node-n-us:_pass_phrase_@_stats_node_ip_:8081 --targetgaslimit 94000000`</br>
</p>
</p>
<p>To get the network working smooth we should take care about peer discovery.</p>
<p>There are two options:</p>
<ol>
<li>
<p>Create <code>_datadir_/static-nodes.json</code> with the following content:
<p class="bash-command">
   [</br>
   "enode://pubkey@ip:port",</br>
   "enode://pubkey@ip:port"</br>
   ]</br>
   </p>
</p>
</li>
<li>
<p>Connect to geth console using command and add peers manually:
<p class="bash-command">
   $ ~/go-ethereum/build/bin/geth attach ipc:seal-node-n/geth.ipc</br>
   > admin.addPeer("enode://pubkey@ip:port")</br> </p>
</p>
</li>
</ol>
<p>Below you can see console output of three US seal nodes:
<img src="ethconsole.png" alt="ethconsole">
Whereas ethstats screen should look like this:
<img src="ethstats.png" alt="ethstats"></p>
<h3 id="running-transactions">Running transactions</h3>
<p>We encourage you to play with network setup and configuration. Meanwhile, for demonstration purposes we provide a few results obtained with the following configuration:</p>
<ol>
<li>Bootnode, 3 seal nodes in EU, 3 seal nodes in US</li>
<li>Block creation time 2 seconds</li>
<li>Block target gas limit 94000000</li>
</ol>
<h5 id="interval-tests">Interval tests</h5>
<p>Transactions are submitted periodically(every second).<br>
500 transactions were accepted by network in 500 in 8161:
<img src="interval-1.png" alt="intwrval-1">
300 transactions are accepted by network in 5900:
<img src="interval-2.png" alt="intwrval-2">
Sequence tests
Transactions are executed in batches. Each subsequent batch starts after previous is finished.
100 transactions each were accepted by network in 5610:
<img src="sequence-1.png" alt="sequence-1">
700 transactions are accepted by network in 14937:
<img src="sequence-1.png" alt="sequence-2">
As it is stated earlier the main purpose of this article is to cover devops part. Thus, we believe, you will invest more time in understanding Clique tuning it instead of having headache setting it up. Soon we release insight how to tune private setup to get maximum TPS! You are always welcome to reach out for advice to one of our <a href="https://pragmaticdlt.com/">Pragmatic DLT SWAT Teams</a> or <a href="https://pragmaticdlt.com/onlineacademy.html">to add Ethereum platform to your skillset. automotive web design agencies</a> Stay tuned!</p>
</section>
    </main>

    
    <section class="banner">
  <h1>Let’s build something great together</h1>
  <button class="contact-us">Free Quote</button>
</section>


    <footer>
  <div class="content">
    <section>
      <a href="index.html" class="logo">
        <img src="../../images/logo.svg" alt="Pragmatic DLT" />
        <h1 class="logo-text">pragmatic<br /><span>dlt</span></h1>
      </a>

      <section class="socials">
        <a
          href="https://www.facebook.com/pragmaticDLT/"
          target="_blank"
          rel="noopener"
          ><img src="../../images/footer/facebook.svg" alt="Facebook"
        /></a>
        <a
          href="https://www.linkedin.com/company/pragmatic-dlt/"
          target="_blank"
          rel="noopener"
          ><img src="../../images/footer/linkedin.svg" alt="LinkedIn"
        /></a>
        <a href="https://medium.com/pragmaticdlt" target="_blank" rel="noopener"
          ><img src="../../images/footer/medium.svg" alt="Medium"
        /></a>
        <a
          href="https://twitter.com/PragmaticDLT"
          target="_blank"
          rel="noopener"
          ><img src="../../images/footer/twitter.svg" alt="Twitter"
        /></a>
      </section>

      <div class="badges">
        <div
          class="clutch-widget"
          data-url="https://clutch.co"
          data-widget-type="2"
          data-height="50"
          data-clutchcompany-id="629361"></div>
        <a
          target="_blank"
          href="https://www.goodfirms.co/companies/view/11381/pragmatic-dlt-inc">
          <img
            style="width: 180px"
            src="https://goodfirms.s3.amazonaws.com/badges/white-button/list-blockchain-technology-companies.svg"
            alt="GoodFirms Badge" />
        </a>
      </div>
    </section>

    <section>
      <nav>
        <a href="../../privacy.html">Privacy Policy</a>
      </nav>

      <a href="mailto:hello@pragmaticdlt.com" class="email"
        >hello@pragmaticdlt.com</a
      >

      <section class="offices">
        <article>
          <h6>United States</h6>
          <p>8 The Green, STE 4000 Dover, DE 19901</p>
        </article>

        <article>
          <h6>Canada</h6>
          <p>1077 College Str., Unit 1, Toronto, ON M6H 1B4</p>
        </article>

        <article>
          <h6>Ukraine</h6>
          <p>Lift99 Kyiv Hub, Volodymyrska St, 101, Kyiv, 02000</p>
        </article>
      </section>

      <p>
        © 2023 Pragmatic DLT Inc. All rights reserved. Pragmatic DLT, the
        Pragmatic DLT logo are trademarks of Pragmatic DLT Inc.<br />
        Registered office: 1077 College Str., Unit 1, Toronto, ON M6H 1B4,
        Canada.
      </p>
    </section>
  </div>
</footer>
<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
<script src="../../js/clamp.min.js"></script>
<script src="../../js/navigation.js"></script>
<script src="../../js/index.js"></script>
</body>
</html>
